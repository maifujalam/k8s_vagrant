# Lab - Seccomp

  - Take me to the [Lab](https://kodekloud.com/topic/lab-seccomp/)

Solutions to Lab - Seccomp:

1.  <details>
    <summary>Which of the following commands/tools can be used to trace syscalls ?</summary>

      * `getcap`
      * `tcpdump`
      * `strace`
      * `getpcap`

      <details>
      <summary>Reveal</summary>

      * `strace` - which stands for "syscall trace"

      </details>
    </details>

1.  <details>
    <summary>Which syscall is NOT made by the command <code>ls /root</code>?</summary>

    Try it out for yourself using strace.

      ```bash
      strace -c ls /root
      ```

      * execve
      * connect
      * read
      * access

      <details>
      <summary>Reveal</summary>

      * `connect` - This call is used for connecting network sockets - not required to list a local directory.

      </details>

    </details>

1. For answering the next question, open a new terminal on the controlplane node by clicking on the `+` button next to Terminal 1. Next, on this new terminal, run the Tracee tool as a container, with the appropriate flags to detect syscalls from new containers.

    On the controlplane node, run:

    ```
    kubectl apply -f /root/tracee-deployment.yaml
    ```

    After the pod becomes ready , stream the logs using below command:

    ```
    kubectl logs -f `kubectl get pods -l=io.kompose.service=tracee -o custom-columns=":metadata.name" --no-headers`
    ```

    Tracee is now running as a pod in the cluster and is listening for events. Switch to the second terminal to run commands in following questions and switch back to see the tracee output when needed.


1.  <details>
    <summary>We have just scheduled a new pod. What is the command run by the container inside this pod?</summary>

    Inspect the pod called `hello`

      <details>
      <summary>Reveal</summary>

      * `echo hello`

      </details>

    </details>

1.  <details>
    <summary>What is the current status of the pod called hello?</summary>

      ```
      kubectl get pod hello
      ```

      <details>
      <summary>Reveal</summary>

      * `Completed`

      </details>

    </details>

1.  <details>
    <summary>Observe the output captured by the tracee container.</summary>

    Which was the last syscall that was generated by the container that ran the message echo hello?

    Switch back to the terminal where you l;eft the tracee log output running. Examine the `EVENT` column

      <details>
      <summary>Reveal</summary>

      * `sched_process_exit`

      </details>

    </details>

1.  <details>
    <summary>A seccomp profile file called <code>custom-profile.json</code> has been placed under <code>/root</code> directory.</summary>

    What type of a profile is this?

      <details>
      <summary>Reveal</summary>

      * ` whitelist type profile` -  to ensure that exactly and only the specified syscalls could ever be used.

      </details>

    </details>

1.  <details>
    <summary>Another seccomp profile file called <code>relaxed-profile.json</code> has been placed under <code>/root</code>directory.</summary>

    What is the default action set in this profile?

      <details>
      <summary>Reveal</summary>

      Check the value of the defaultAction set inside the file
      * `SCMP_ACT_ALLOW`

      </details>

    </details>

1.  <details>
    <summary>What is the default Seccomp profile location in this cluster?</summary>

    The default location for seccomp profiles is the `seccomp` dubdirectory of the kubelet installation on each node, normally

    ```
    /var/lib/kubelet/seccomp
    ```
    </details>

1.  <details>
    <summary>Create a new pod called <code>audit-nginx</code> using the <code>nginx</code> image and make use of the <code>audit.json</code> seccomp profile in the pod's security context</summary>

    The `audit.json` file is already present in the default seccomp profile path in the `controlplane` node.

      <details>
      <summary>Reveal</summary>

      Note the profile JSON file

      ```
      ls -l /var/lib/kubelet/seccomp/profiles/
      ```

      Profile paths in manifests are specified *relative* to the default profile directory.

      ```yaml
      apiVersion: v1
      kind: Pod
      metadata:
        labels:
          run: nginx
        name: audit-nginx
      spec:
        securityContext:
          seccompProfile:
            type: Localhost
            localhostProfile: profiles/audit.json
        containers:
        - image: nginx
          name: nginx
      ```

      </details>
    </details>

